function [Y,Xf,Af] = N17(X,~,~)
%N17 neural network simulation function.
%
% Auto-generated by MATLAB, 30-Mar-2022 15:08:01.
% 
% [Y] = N17(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-1404.42196927965;-1545.8062703497;-1401.86693926553;-1617.80627432841;-1325.08539690759;-1367.46224197007;-917.042991234906;-1035.28615356467;-853.674187197359;-898.475478981491;-954.552546869696;-910.914731964453;-739.362754867167;-709.61186052109;-688.98404623647;-535.990732049711;-621.704603206622;-777.393182505543;-623.14398341783;-561.208406285766];
x1_step1.gain = [0.000561763957521318;0.000600296195040293;0.000737427740887762;0.00065244879023272;0.000878695552871815;0.00083624396331541;0.00110434901186281;0.000976128028683826;0.00107215045872957;0.00121628951202905;0.000869679000202023;0.00120981994903393;0.00138183599880744;0.00121973594326434;0.00155694189168901;0.0015074114389932;0.00184563780005458;0.00133609633424475;0.00169407980743493;0.00180446176479345];
x1_step1.ymin = -1;

% Layer 1
b1 = [5.1588322471403795788;4.743519184880199191;3.8751566237912946633;-3.5414395765594797183;0.87642033914870565159];
IW1_1 = [-1.0878957487526481618 -3.3507401303481980648 1.8901021337865717697 -0.67170678646000780976 -1.8870141995321785267 -0.40677603288247959901 4.3216233421373777546 2.5117757656016621581 -1.796231581878156458 5.2849833817634355171 0.44995917649545935646 -1.3408587539305425462 -0.45652131269061857477 1.4799330881851826547 -0.25914864503408174823 1.9106615997236602311 2.0641722505884252392 -2.8012096810375672895 0.77902916669874744393 -1.4317864890198379602;4.6965240546963409329 -2.8887756329210434458 -0.81504484841924296212 -3.4530966210667095595 0.3608881848691088412 0.071337891730262045775 0.074438979942849939353 -4.7506602359607725816 -0.51327251790610173288 12.027136864504869962 5.7521007824853747081 -1.7606207377412306236 3.9364529736717726038 -3.1483918225242666367 3.8911123175650308426 -2.0146981378880832736 5.6184926517723141615 -3.0789089010254673262 1.739871164584195995 1.1087032808530759009;1.0121035119228554144 -3.1449651812989340982 -0.72815836734645489337 -0.11746185195679167967 -3.8269963638475381629 -0.056004776377639037266 4.1022649811425972999 0.75967105867410178455 -0.83231905933410088583 0.80784375766543614628 0.060467754592483144438 0.63561228768556798929 -1.2225409160291795807 1.9326287573371978556 1.5908788780829108411 -0.53189862423444322914 -0.18164791018802523004 -1.1337304464970658913 0.16253051723284761554 -1.9060099992823988924;-0.62459585705868569949 1.3902132130134969845 0.53234563428444925393 -1.2241884506254006038 3.6440058787441627075 -1.3163763482696611007 -4.4511849932182547818 -1.5014154174597094116 0.41432853279970749405 0.072188485108494654385 0.92188069411055750813 -2.0722465855572429483 -0.23028162895507342522 0.050533965602524794081 -1.5804685703365652927 2.165563510897893007 -0.039270494272234050814 0.81636991740842446141 -1.4513670874088930862 3.8017190404524239256;-0.028948695095714578607 0.018411445172662438408 0.0092771673182340079478 0.0094289642898059845139 0.023842952409349242593 -0.012011054270964896529 -0.025591825051046131201 0.011584645109468431901 0.012284025416883601056 -0.063379678704255620891 -0.049853148146478884484 0.012022819055544557362 -0.0069607848667953909141 -0.015793211721422173444 -0.018007122550505780256 0.02078195922925603692 -0.034665763045789693697 0.058939224018691747931 -0.0019980927498999666997 0.018903889396903451187];

% Layer 2
b2 = [0.71272752947780904087;-0.55708486269121559875];
LW2_1 = [0.061562262764938230353 -0.030580164468367119351 -0.11977216883518632118 -0.10830779582389404858 -0.79890188803819850438;-0.07234778637026474668 0.032657330389263834747 0.10787508294993786162 0.076542946856395066568 0.93945742372293561395];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [0.182174377454036;0.18900107551606];
y1_step1.xoffset = [-6.4731774081657;-5.73096374398679];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
